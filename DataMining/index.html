<!-- blogPosts:text[] -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html lang="en">
<head>
  <title>Michael's blog</title>
  <meta charset="utf-8">
  <link rel="stylesheet" type="text/css" href="../static/main.css">
  <link rel="stylesheet" type="text/css" href="../static/typeplate.css">
  <link rel="stylesheet" type="text/css" href="../static/highlight/styles/solarized_dark.css">  
  <script type="text/javascript"  src="../static/jquery.min.js"></script>
  <script type="text/javascript"  src="../static/main.js"></script>
  <script type="text/javascript"  src="../static/highlight/highlight.pack.js"></script>
  
</head>
<body>
  <div class="mainSection">
    <div id="navigation">
      <div id="gertruda">
	<a href="../index.html" class="stripHREF" id="symbol">
	</a>
	<div id="slogan">
	</div>
      </div>
      <div id="spacer"></div>	

      <!-- tag.name:string -->
<!-- tag.size:number -->
<!-- tagsList:tag[] -->
<!-- selectedTagSet:set<string> -->

<div class="tagContainer">
  
    
      
    		   

    
      <a class="tag smallTag stripHREF " href="../TypeScript/index.html" style="font-size:14px;">TypeScript</a>
    
  
    
      
    		   

    
      <span class="tag tag__selected stripHREF smallTag" href="/DataMining/" style="font-size:14px;">DataMining</span>
    
  
    
      
    		   

    
      <a class="tag smallTag stripHREF " href="../Contacts/index.html" style="font-size:14px;">Contacts</a>
    
  
    
      		   
    		   

    
      <a class="tag bigTag stripHREF " href="../python/index.html" style="font-size:36px;">python</a>
    
  
    
      		   
    		   

    
      <a class="tag bigTag stripHREF " href="../hour-of-coding/index.html" style="font-size:28px;">hour-of-coding</a>
    
  
    
      
    		   

    
      <a class="tag smallTag stripHREF " href="../static-typing/index.html" style="font-size:21px;">static-typing</a>
    
  
    
      
    		   

    
      <a class="tag smallTag stripHREF " href="../immutable.js/index.html" style="font-size:14px;">immutable.js</a>
    
  
    
      
    		   

    
      <a class="tag smallTag stripHREF " href="../debian/index.html" style="font-size:21px;">debian</a>
    
  
    
      
    		   

    
      <a class="tag smallTag stripHREF " href="../GoLang/index.html" style="font-size:14px;">GoLang</a>
    
  
    
      
    		   

    
      <a class="tag smallTag stripHREF " href="../flask/index.html" style="font-size:14px;">flask</a>
    
  
    
      
    		   

    
      <a class="tag smallTag stripHREF " href="../typescript/index.html" style="font-size:14px;">typescript</a>
    
  
    
      
    		   

    
      <a class="tag smallTag stripHREF " href="../jinja2/index.html" style="font-size:14px;">jinja2</a>
    
  
    
      
    		   

    
      <a class="tag smallTag stripHREF " href="../play-video/index.html" style="font-size:14px;">play-video</a>
    
  
    
      
    		   

    
      <a class="tag smallTag stripHREF " href="../scraping/index.html" style="font-size:14px;">scraping</a>
    
  
    
      
    		   

    
      <a class="tag smallTag stripHREF " href="../DEPTA/index.html" style="font-size:14px;">DEPTA</a>
    
  
    
      
    		   

    
      <a class="tag smallTag stripHREF " href="../Hello/index.html" style="font-size:14px;">Hello</a>
    
  
    
      		   
    		   

    
      <a class="tag bigTag stripHREF " href="../tutorial/index.html" style="font-size:36px;">tutorial</a>
    
  
</div>    
    </div>
    <div id="content">
      <!-- <h3>Hello I am Michael. I write stuff and play piano</h3> -->
      
<div class="blogPost">
  <h2>Simulated annealing for complete dummies[like me]</h2>
<p>What is the way of understanding some complex thing.
It is to try to find the easiest possible example of using it.
So, we will use <strong>simulated annealing</strong> for working out simple equasion. Here it is:
<code>(x+123)*(x-47)*(x+19)*(x-96) = 0</code>
Our task is to find at least one root of this equasion. </p>
<h3>Step one. Define API. It will work as interface between any problem, and algorithm</h3>
<p>Here it is.
<code>interface IProblem&lt;DataFrame&gt; {
     energy:(data:DataFrame)=&gt;number
     neighbour:(data:DataFrame)=&gt;DataFrame
     startingTemp:number
     stopTemp:number
     decreaseRate:number
     initState:DataFrame
 }</code>
<strong>energy</strong> is a function which will give <em>rating</em> to our state. And it looks like this:
<code>function(x:number):number{
    return Math.abs((110+x)*(213+x)*(245+x)*(143+x))
}</code>
Several notes:</p>
<ol>
<li><strong>energy</strong> function must be positive.</li>
<li>For simplicity sake we use the simpliest format <strong>number</strong> of data representation.</li>
</ol>
<p>Second one is <strong>neighbour</strong> function. It takes state,and derives state with similar energy. The first thing that comes to mind is just to use -1 +1 array. Like this:
<code>function(data:number){
     return data + _.sample([-1,1])
},</code>
<strong>_.sample</strong> function takes random element from array. It is from <a href="https://lodash.com/docs">lodash</a>.</p>
<p>Following params are algorithm  constants. People suggest to change them empirically to find what fits best  for your problem
<code>startingTemp:number
stopTemp:number
decreaseRate:number</code></p>
<p>Formula in function <strong>ifChange</strong> usually stays unchanged on every problem. "This formula was superficially justified by analogy with the transitions of a physical system" says <a href="http://en.wikipedia.org/wiki/Simulated_annealing#Acceptance_probabilities_2">wiki</a>.
Pseudocode:
<code>#Acceptance probability
def ifChange(energy:number,newEnergy:number,temperature:number):boolean
  #This solution is better. Use it
  if newEnergy&lt;energy
    return true
  #This solution is worse. Determine if we use it by Acceptance_probabilities described from above 
  random:number = Math.random()
  probability:number = Math.pow(Math.E,((energy-newEnergy)/temperature))
  return probability&gt;=random
 #annealing
currentState  = someRandomState
bestState     = currentState
while currentTemperature &gt; minimumTemperature:
  newState = neighbour(currentState)
  # determine if Algorithm should jump to another state
  if ifChange(energy(currentState),energy(newState),currentTemperature)
    currentState = newState
  # keep best solution   
  if energy(currentState) &lt; energy(bestState) 
    bestState = currentState
  decreaseTemperature()</code>
So. Here is an implementation of that algorithm in <strong>Typescript</strong>:
<code>function  ifChange(energy:number,newEnergy:number,temperature:number):boolean{
  // This solution is better. Use it
  if (newEnergy&lt;energy){
    return true
  }
  // Choose if we are to use worse solution or not
    var random:number = Math.random()
    var probability:number = Math.pow(Math.E,((energy-newEnergy)/temperature))
    return probability&gt;=random
  }
export function Solution&lt;DataFrame&gt;(data:IProblem&lt;DataFrame&gt;){
  var state        = data.initState
  var bestState    = data.initState
  var nowTemp      = data.startingTemp
  console.log("Starting optimization with state: ",state,
              " and startingTemp: ",data.startingTemp)
  while(nowTemp&gt;data.stopTemp){
    var newRandomState = data.neighbour(state)
    if(ifChange(data.energy(state),data.energy(newRandomState),nowTemp)){
      state = newRandomState
    }
    nowTemp= nowTemp * (1-data.decreaseRate)
    // Keep track of the best solution found
    if (data.energy(state) &lt; data.energy(bestState)) {
      bestState = state
    }
  }
  console.log("Cooled down. Best solution so far: ",bestState,
              "with energy: ",data.energy(bestState))
  return bestState
}</code></p>
<p>And here is a definition of our problem in terms of defined architecture:
<code>module SampleAnnealingSolution {
  var quadratic:Annealing.IProblem&lt;number&gt; = {
    energy:function(x:number):number{
      return Math.abs((110+x)*(213+x)*(245+x)*(143+x))
    },
    neighbour:function(data:number){
      return data + _.sample([-3,-2,-1,1,2,3])
    },
    startingTemp:40000,
    stopTemp:0.4,
    decreaseRate:0.03,
    initState:0
  }
  console.log(Annealing.Solution(quadratic))
}</code></p>
<ul>
<li>You can play with constants to find what  suits your problem best.</li>
<li>This algorithm will find only one root. You can use it to find all roots of arbitrary equation by running algorithm consequently.</li>
</ul>
<p>Source code can be found <a href="https://github.com/VbifRkbvjd/simpleAnnealing">here</a></p>
<p>Running code from above will give you something like this in dev. console:
<img src="../static/public/annealingResult.png" width="100%"></p>
</div>


    </div>
  </div>    
</body>
</html>